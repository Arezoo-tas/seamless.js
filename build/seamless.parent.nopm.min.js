/*! seamless.js 2014-04-11 */
var SeamlessBase={getParam:function(a,b){b=b||window.location.search;var c="[?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}},SeamlessConnection=function(a,b){this.id=null,this.target=a,this.url=b,this.active=!1,this.queue=[];var c=SeamlessBase.getParam("iframeId");c&&(this.id=c)};SeamlessConnection.prototype.send=function(a){this.active&&this.target?(a.hasOwnProperty("data")||(a={data:a}),a.target=this.target,a.url=this.url,a.type=a.type||"seamless_data",a.data=a.data||{},a.data.__href=window.location.href,a.data.__id=this.id,$.pm(a)):this.queue.push(a)},SeamlessConnection.prototype.receive=function(a,b){"function"==typeof a&&(b=a,a="seamless_data");var c=this;$.pm.bind(a,function(a,d){return a.__id===c.id?b(a,d):!1})},SeamlessConnection.prototype.setActive=function(a){if(this.active=a,this.queue.length>0){for(var b in this.queue)this.send(this.queue[b]);this.queue=[],this.queue.length=0}},function(a){if(!a.hasOwnProperty("pm"))return void console.log("You must install the jQuery.pm module to use seamless.js.");a.pm.bind("seamless_noiframe",function(a){a.href=a.href.replace(/noiframe\=[^&?#]+/,""),window.location.replace(a.href)}),window.seamlessOpenFallback=function(a,b){b.preventDefault?(b.preventDefault(),b.stopPropagation()):b.returnValue=!1,window.open(a,"",["width=960","height=800","menubar=no","titlebar=no","toolbar=no","status=no","scrollbars=yes","chrome=yes"].join(","))};a.fn.seamless=function(b){var c={loading:"Loading ...",spinner:"http://www.travistidwell.com/seamless.js/src/loader.gif",fallback:!0,fallbackParams:"",fallbackText:"",fallbackLinkText:"Click here",fallbackLinkAfter:" to open in a separate window.",fallbackStyles:["padding: 15px","border: 1px solid transparent","border-radius: 4px","color: #3a87ad","background-color: #d9edf7","border-color: #bce8f1"]};b=b||{};for(var d in c)b.hasOwnProperty(d)||(b[d]=c[d]);var e=a(this).eq(0),f=e.attr("name")||e.attr("id"),g=e.attr("src"),h=new SeamlessConnection(window.frames[f],g);h.id=SeamlessBase.getParam("iframeId",g)||g,e.send=function(a){h.send.call(h,a)},e.receive=function(a,b){h.receive.call(h,a,b)},e.attr({scrolling:"no",seamless:"seamless",width:"100%",height:"0px"}).css({border:"none",overflowY:"hidden"});var i=a(document.createElement("div")).css({background:"url("+b.spinner+") no-repeat 10px 13px",padding:"10px 10px 10px 60px",width:"100%"}),j=!0;if(i.append(b.loading),e.before(i),b.fallback){b.fallbackParams&&(g+=-1===g.search(/\?/)?"?":"&",g+=b.fallbackParams);var k=a(document.createElement("a")).attr({"class":"seamless.js-fallback-link",href:"#",onclick:'seamlessOpenFallback("'+g+'", event)'});k.append(b.fallbackLinkText);var l=a(document.createElement("div")).attr({"class":"seamless.js-fallback"});l.append(a(document.createElement("em")).attr({style:"padding: 5px;"})),e.after(l);var m=function(a,c){l.attr("style",c?b.fallbackStyles.join(";"):""),l.find("em").text(a+" ").append(k).append(b.fallbackLinkAfter)};b.fallbackText&&m(b.fallbackText,!1),a(window).error(function(){var a="An error has been detected on this page, ";a+="which may cause problems with the operation of this application.",m(a,!0)}),setTimeout(function(){j&&(i.remove(),j=!1,m("An error has been detected on this page.",!0))},3e4)}return a.pm.bind("seamless_update",function(a){return j&&(a.__id||-1===a.__href.search(g)||(a.__id=h.id),a.__id==h.id?(i.remove(),j=!1,h.setActive(!0),e.trigger("connected")):a.height=0),a.__id==h.id&&a.height>0&&e.height(a.height).attr("height",a.height+"px"),a}),e}}(jQuery);