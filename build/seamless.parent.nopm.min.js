/*! seamless.js 2014-04-12 */
var SeamlessBase={getParam:function(a,b){b=b||window.location.search;var c="[?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}},SeamlessConnection=function(a,b){this.id=null,this.target=a,this.url=b,this.active=!1,this.queue=[];var c=SeamlessBase.getParam("iframeId");c&&(this.id=c)};SeamlessConnection.prototype.send=function(a){this.active&&this.target?(a.hasOwnProperty("data")||(a={data:a}),a.target=this.target,a.url=this.url,a.type=a.type||"seamless_data",a.data=a.data||{},a.data.__id=this.id,$.pm(a)):this.queue.push(a)},SeamlessConnection.prototype.receive=function(a,b){"function"==typeof a&&(b=a,a="seamless_data");var c=this;$.pm.bind(a,function(a,d){return a.__id===c.id?b(a,d):!1})},SeamlessConnection.prototype.setActive=function(a){if(this.active=a,this.queue.length>0){for(var b in this.queue)this.send(this.queue[b]);this.queue=[],this.queue.length=0}},function(a){if(!a.hasOwnProperty("pm"))return void console.log("You must install the jQuery.pm module to use seamless.js.");a.pm.bind("seamless_noiframe",function(a){a.href=a.href.replace(/noiframe\=[^&?#]+/,""),window.location.replace(a.href)}),window.seamlessOpenFallback=function(a,b){b.preventDefault?(b.preventDefault(),b.stopPropagation()):b.returnValue=!1,window.open(a,"",["width=960","height=800","menubar=no","titlebar=no","toolbar=no","status=no","scrollbars=yes","chrome=yes"].join(","))};var b=[],c=1,d=!1;a.pm.bind("seamless_ready",function(){if(!d){d=!0;for(var e in b){var f=b[e];f.connection.id||(f.connection.id=c++),a.pm({type:"seamless_connect",target:f.connection.target,url:f.connection.url,data:{id:f.connection.id}})}d=!1}}),a.pm.bind("seamless_update",function(a,c){for(var d in b){var e=b[d];if(e.connection.id===a.__id)return e.seamless_update(a,c)}return a.height=0,a}),a.fn.seamless=function(c){var d={loading:"Loading ...",spinner:"http://www.travistidwell.com/seamless.js/src/loader.gif",fallback:!0,fallbackParams:"",fallbackText:"",fallbackLinkText:"Click here",fallbackLinkAfter:" to open in a separate window.",fallbackStyles:["padding: 15px","border: 1px solid transparent","border-radius: 4px","color: #3a87ad","background-color: #d9edf7","border-color: #bce8f1"]};c=c||{};for(var e in d)c.hasOwnProperty(e)||(c[e]=d[e]);var f=a(this).eq(0);b.push(f);var g=f.attr("name")||f.attr("id"),h=f.attr("src");f.connection=new SeamlessConnection(window.frames[g],h),f.connection.id=SeamlessBase.getParam("iframeId",h)||h,f.send=function(a){f.connection.send.call(f.connection,a)},f.receive=function(a,b){f.connection.receive.call(f.connection,a,b)},f.attr({scrolling:"no",seamless:"seamless",width:"100%",height:"0px"}).css({border:"none",overflowY:"hidden"});var i=a(document.createElement("div")).css({background:"url("+c.spinner+") no-repeat 10px 13px",padding:"10px 10px 10px 60px",width:"100%"}),j=!0;if(i.append(c.loading),f.before(i),c.fallback){c.fallbackParams&&(h+=-1===h.search(/\?/)?"?":"&",h+=c.fallbackParams);var k=a(document.createElement("a")).attr({"class":"seamless.js-fallback-link",href:"#",onclick:'seamlessOpenFallback("'+h+'", event)'});k.append(c.fallbackLinkText);var l=a(document.createElement("div")).attr({"class":"seamless.js-fallback"});l.append(a(document.createElement("em")).attr({style:"padding: 5px;"})),f.after(l);var m=function(a,b){l.attr("style",b?c.fallbackStyles.join(";"):""),l.find("em").text(a+" ").append(k).append(c.fallbackLinkAfter)};c.fallbackText&&m(c.fallbackText,!1),a(window).error(function(){var a="An error has been detected on this page, ";a+="which may cause problems with the operation of this application.",m(a,!0)}),setTimeout(function(){j&&(i.remove(),j=!1,m("An error has been detected on this page.",!0))},3e4)}return f.seamless_update=function(a){return j&&(i.remove(),j=!1,f.connection.setActive(!0),f.trigger("connected")),a.height>0&&f.height(a.height).attr("height",a.height+"px"),a},f}}(jQuery);