/*! seamless.js 2014-04-15 */
var SeamlessBase={getParam:function(a,b){b=b||window.location.search;var c="[?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},isEmptyObject:function(a){var b;for(b in a)return!1;return!0}},SeamlessConnection=function(a,b){this.id=0,this.target=a,this.url=b,this.active=!1,this.queue=[]};SeamlessConnection.prototype.send=function(a){this.active&&this.target?(a.hasOwnProperty("data")||(a={data:a}),a.target=this.target,a.url=this.url,a.type=a.type||"seamless_data",a.data=a.data||{},a.data.__id=this.id,$.pm(a)):this.queue.push(a)},SeamlessConnection.prototype.receive=function(a,b){"function"==typeof a&&(b=a,a="seamless_data");var c=this;$.pm.bind(a,function(a,d){return a.__id&&a.__id===c.id?b(a,d):!1})},SeamlessConnection.prototype.setActive=function(a){if(this.active=a,this.queue.length>0){for(var b in this.queue)this.send(this.queue[b]);this.queue=[],this.queue.length=0}},function(a,b,c){return c.hasOwnProperty("pm")?void(c.seamless={options:{url:"",container:"body",update:200,allowStyleInjection:!1,onUpdate:null,onConnect:null},connect:function(d){d=d||{};for(var e in d)this.options.hasOwnProperty(e)&&(this.options[e]=d[e]);d=this.options;var f=new SeamlessConnection(a.parent,d.url);f.setActive(!0);var g=SeamlessBase.getParam("noiframe").toString();if("1"===g||"true"===g.toLowerCase())f.send({type:"seamless_noiframe",data:{href:a.location.href}});else{var h=!1,i=d.container;i instanceof jQuery||(i=c(i));var j=0,k=0,l=function(){k&&clearTimeout(k);var a=i.outerHeight(!0);if(a=a>100?a:100,!h&&j!==a){h=!0;var b={height:a};d.onUpdate&&d.onUpdate(b),f.send({type:"seamless_update",data:b,success:function(a){j=a.height,h=!1}})}k=setTimeout(l,d.update)},m=function(){f.id||(f.send({type:"seamless_ready",data:{}}),setTimeout(m,200))},n=function(a){if(d.allowStyleInjection&&a.length>0){a="string"==typeof a?a:a.join(""),a=a.replace(/[<>]/g,"");var e=c("style#injected-styles");e.length>0?e.html(a):c("head").append(c(b.createElement("style")).attr({type:"text/css",id:"injected-styles"}).append(a))}};c.pm.bind("seamless_styles",function(a){n(a),l()}),c.pm.bind("seamless_connect",function(a){return f.id=a.id,d.onConnect&&d.onConnect(a),n(a.styles),l(),a}),m()}return f}}):void console.log("You must install the jQuery.pm module to use seamless.js.")}(window,document,jQuery);